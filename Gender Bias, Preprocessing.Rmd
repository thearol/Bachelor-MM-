---
title: "Gender_bias"
author: "Thea Rolskov Sloth"
date: "12/11/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#Getting packages
```{r loading packages, include = FALSE}
library(pacman)
p_load(brms, tidyverse, tidybayes, ggplot2, LaplacesDemon, rethinking, tidyr, reshape2, tibble, plotly, jpeg, tm, ggrepel, utils)
```

#Setting directory
```{r}
setwd("~/Bachelor-MM-/") #TRS
```

#Loading data
```{r}
data_ib <- read.csv("implicit_bias/data_ib.csv")[,2:12]
data_eb <- read.csv("explicit_bias/eb_results.csv")[, 2:6]
data_db <- read.csv("decision_bias/disagree_sensitivity_db_long.csv")[, 2:44]
data_db_all <- read.csv("decision_bias/data_db_all.csv")
```

#Creating new data frame with relevant variables for gender bias
```{r}
#Selecting age, gender, ID
data_gb <- unique(data_ib[, 1:3])

#Adding rt dif
ib_rt <- as.data.frame(data_ib%>% group_by(ID, condition) %>% summarise(rt_log_mean = mean(rt_log)))
data_gb$rt_dif_log <- filter(ib_rt, condition == 1)$rt_log_mean - filter(ib_rt, condition == 0)$rt_log_mean

#Adding sexism scores
data_gb <- merge(data_gb, data_eb)

#adding random effect of decision bias 
data_gb$B_M  <- as.data.frame(ranef(model_db2))[,5] #Inserting the random effect of skill_dif_roll_c:Follower_genderMale
data_gb$B_F  <- as.data.frame(ranef(model_db2))[,1] #Inserting the random effect of skill_dif_roll_c:Follower_genderFemale

#Adding the fixed effect of decision bias
#FF
data_gb$B_F[data_gb$gender =="Female"]  <- data_gb$B_F[data_gb$gender =="Female"] + as.data.frame(fixef(model_db2))[8,1] #Inserting the random effect of skill_dif_roll_c:Follower_genderMale
#MF
data_gb$B_F[data_gb$gender =="Male"]  <- data_gb$B_F[data_gb$gender =="Male"] + as.data.frame(fixef(model_db2))[9,1] #Inserting the random effect of skill_dif_roll_c:Follower_genderMale
#FM
data_gb$B_M[data_gb$gender =="Female"] <- data_gb$B_M[data_gb$gender =="Female"] + as.data.frame(fixef(model_db2))[10,1] #Inserting the random effect of skill_dif_roll_c:Follower_genderMale
#MM
data_gb$B_M[data_gb$gender =="Male"]  <- data_gb$B_M[data_gb$gender =="Male"] + as.data.frame(fixef(model_db2))[11,1] #Inserting the random effect of skill_dif_roll_c:Follower_genderMale

#Inverse logit the decision bias
data_gb$B_M_p <- inv_logit(data_gb$B_M)
data_gb$B_F_p <- inv_logit(data_gb$B_F)

```

